// ============================================================================
//                  NAINTEETH'S NIRI WINDOW MANAGER CONFIGURATION
// ============================================================================
// Documentation: https://github.com/YaLTeR/niri/wiki/Configuration:-Overview

// ============================================================================
//                                DEPENDENCIES
// ============================================================================
// Core system packages (dnf):
//   - niri waybar rofi kitty nautilus
//   - waypaper xwayland-satellite
// Flatpak applications:
//   - app.zen_browser.zen
//   - io.missioncenter.MissionCenter

// ============================================================================
//                               ENVIRONMENT
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Environment
// environment {
  // DISPLAY ":0"
// }

// ============================================================================
//                                 OUTPUTS
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Outputs
output "DP-2" {
  mode "1920x1080@240"
  transform "normal"
  position x=0 y=0
  scale 1
}

output "DP-1" {
  mode "3840x2560@60"
  transform "normal"
  position x=-1920 y=0
  scale 2
}

// ============================================================================
//                              INPUT DEVICES
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Input
input {
  tablet {
    off
    map-to-output "DP-2"
  }

  keyboard {
    xkb {
      layout "de"
    }
  }

  mouse {
    accel-profile "flat"
  }

  focus-follows-mouse max-scroll-amount="0%"
}

// ============================================================================
//                                 LAYOUT
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Layout
layout {
  gaps 16
  center-focused-column "never"

  preset-column-widths {
    proportion 0.33333
    proportion 0.5
    proportion 0.66667
  }

  default-column-width { proportion 0.5; }

  focus-ring {
    width 3
    active-color "#CBA6F740"
    inactive-color "#45475A20"
  }

  border {
    off
  }

  shadow {
    on
    draw-behind-window true
    softness 30
    spread 5
    offset x=0 y=5
    color "#0007"
  }
}// ============================================================================
//                               ANIMATIONS
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Animations
animations {
  slowdown 1.5
}

// ============================================================================
//                              WINDOW RULES
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Window-Rules

window-rule {
  match app-id=r#"zen$"# title="^Picture-in-Picture$"
  open-floating true
}

window-rule {
  match app-id="app.zen_browser.zen"
  open-maximized true
}

window-rule {
  match app-id="steam"
  open-on-output "DP-2"
  open-maximized true
  opacity 0.8 
}

window-rule {
  match app-id="org.keepassxc.KeePassXC"
  opacity 0.9
  block-out-from "screencast"
}
window-rule {
  match app-id="discord"
  open-on-output "DP-1"
  open-maximized true
  opacity 0.9
}

window-rule {
  geometry-corner-radius 12 
  clip-to-geometry true
}

window-rule {
  match app-id="pavucontrol"
  open-floating true
  opacity 0.75
}

window-rule {
  match app-id="kitty"
  default-column-width { proportion 0.5; }
  opacity 0.9
}

window-rule {
    match app-id="org.signal.Signal"
    draw-border-with-background false
    block-out-from "screencast"
    open-on-output "DP-1"
    opacity 0.9
}

// ============================================================================
//                               KEYBINDINGS
// ============================================================================
// https://github.com/YaLTeR/niri/wiki/Configuration:-Key-Bindings
binds {
  // System
  Super+Shift+W { show-hotkey-overlay; }
  Super+O repeat=false { toggle-overview; }
  Super+Q { close-window; }
  Mod+Escape allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; }
  Mod+Shift+E { quit; }
  Ctrl+Alt+Delete { quit; }
  Mod+Shift+P { power-off-monitors; }

  // Navigation
  Mod+H     { focus-column-left; }
  Mod+L     { focus-column-right; }
  Mod+J     { focus-window-or-workspace-down; }
  Mod+K     { focus-window-or-workspace-up; }

  // Window Movement
  Mod+Ctrl+H     { move-column-left; }
  Mod+Ctrl+L     { move-column-right; }
  Mod+Ctrl+J     { move-window-down-or-to-workspace-down; }
  Mod+Ctrl+K     { move-window-up-or-to-workspace-up; }

  // Monitor Controls
  Mod+Shift+H     { focus-monitor-left; }
  Mod+Shift+J     { focus-monitor-down; }
  Mod+Shift+K     { focus-monitor-up; }
  Mod+Shift+L     { focus-monitor-right; }
  Mod+Shift+Ctrl+H     { move-column-to-monitor-left; }
  Mod+Shift+Ctrl+J     { move-column-to-monitor-down; }
  Mod+Shift+Ctrl+K     { move-column-to-monitor-up; }
  Mod+Shift+Ctrl+L     { move-column-to-monitor-right; }

  // Workspaces
  Mod+U              { focus-workspace-down; }
  Mod+I              { focus-workspace-up; }
  Mod+Ctrl+U         { move-column-to-workspace-down; }
  Mod+Ctrl+I         { move-column-to-workspace-up; }
  Mod+Shift+U         { move-workspace-down; }
  Mod+Shift+I         { move-workspace-up; }

  // Mouse Wheel
  Mod+WheelScrollDown      cooldown-ms=150 { focus-workspace-down; }
  Mod+WheelScrollUp        cooldown-ms=150 { focus-workspace-up; }
  Mod+Ctrl+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
  Mod+Ctrl+WheelScrollUp   cooldown-ms=150 { move-column-to-workspace-up; }
  Mod+WheelScrollRight      { focus-column-right; }
  Mod+WheelScrollLeft       { focus-column-left; }
  Mod+Ctrl+WheelScrollRight { move-column-right; }
  Mod+Ctrl+WheelScrollLeft  { move-column-left; }
  Mod+Shift+WheelScrollDown      { focus-column-right; }
  Mod+Shift+WheelScrollUp        { focus-column-left; }
  Mod+Ctrl+Shift+WheelScrollDown { move-column-right; }
  Mod+Ctrl+Shift+WheelScrollUp   { move-column-left; }

  // Window Layout
  Mod+F { maximize-column; }
  Mod+SHIFT+F { fullscreen-window; }
  Mod+V       { toggle-window-floating; }
  Mod+W { toggle-column-tabbed-display; }

  // Applications
  Mod+Return repeat=false hotkey-overlay-title="Terminal" {
    spawn "kitty";
  }

  Mod+B repeat=false hotkey-overlay-title="Browser" {
    spawn "flatpak" "run" "app.zen_browser.zen";
  }
  Mod+E repeat=false hotkey-overlay-title="File Manager" {
    spawn "dolphin";
  }
  Mod+Space hotkey-overlay-title="App Launcher" {
    spawn "wofi" "--show" "drun";
  }
  Mod+M hotkey-overlay-title="Task Manager" {
    spawn "plasma-systemmonitor";
  }
  Mod+P repeat=false hotkey-overlay-title="Volume Mixer" {
      spawn "pavucontrol";
  }

  // Screenshot
  Print { screenshot; }
  Mod+S { screenshot-screen; }
  Mod+Shift+S { screenshot-window; }
}

// ============================================================================
//                          STARTUP APPLICATIONS
// ============================================================================
spawn-at-startup "waybar"
spawn-at-startup "waypaper" "--restore"
spawn-at-startup "mako"
spawn-at-startup "/run/current-system/sw/libexec/polkit-kde-authentication-agent-1"
spawn-at-startup "flatpak" "run" "org.signal.Signal"

// Screenshots
screenshot-path "~/Bilder/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

// ============================================================================
//                            OTHER STUFF 
// ============================================================================
hotkey-overlay {
  skip-at-startup
}
